<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Santa: Gift Delivery</title>
    <style>
        :root { --red: #e74c3c; --snow: #ecf0f1; --night: #1a1a2e; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: var(--night); overflow: hidden; touch-action: none; color: white; }
        
        /* Language Selection Screen */
        #lang-screen {
            position: fixed; inset: 0; background: var(--night);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000;
        }
        .lang-btn {
            width: 200px; padding: 15px; margin: 10px; border: none; border-radius: 10px;
            font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .uz { background: #005a9c; color: white; }
        .ru { background: white; color: #0039a6; }
        .en { background: #cf142b; color: white; }

        /* HUD (Heads-up Display) */
        #hud { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; font-size: 20px; z-index: 100; display: none; }
        
        .santa { position: absolute; bottom: 30px; font-size: 50px; transition: left 0.1s linear; z-index: 50; }
        .house { position: absolute; bottom: 0; font-size: 60px; z-index: 10; }
        .gift { position: absolute; font-size: 30px; z-index: 20; }
        
        #msg { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .btn { background: var(--red); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 20px; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>

<div id="lang-screen">
    <h1 style="margin-bottom: 20px;">CHOOSE LANGUAGE / –¢–ò–õ–ù–ò –¢–ê–ù–õ–ê–ù–ì</h1>
    <button class="lang-btn uz" onclick="startGame('uz')">O'zbekcha üá∫üáø</button>
    <button class="lang-btn ru" onclick="startGame('ru')">–†—É—Å—Å–∫–∏–π üá∑üá∫</button>
    <button class="lang-btn en" onclick="startGame('en')">English üá¨üáß</button>
</div>

<div id="hud">
    <div><span id="label-score">Score</span>: <span id="score">0</span></div>
    <div><span id="label-time">Time</span>: <span id="time">30</span>s</div>
</div>

<div id="msg">
    <h1 id="game-over-title">O'YIN TUGADI</h1>
    <p id="final-res">Siz 0 ta sovg'a yetkazdingiz</p>
    <button class="btn" onclick="location.reload()" id="btn-restart">QAYTA O'YNASH</button>
</div>

<div class="santa" id="santa">üéÖ</div>

<script>
    const i18n = {
        uz: { score: "Sovg'alar", time: "Vaqt", over: "O'YIN TUGADI", res: "Siz {s} ta sovg'a yetkazdingiz", restart: "QAYTA O'YNASH" },
        ru: { score: "–ü–æ–¥–∞—Ä–∫–∏", time: "–í—Ä–µ–º—è", over: "–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê", res: "–í—ã –¥–æ—Å—Ç–∞–≤–∏–ª–∏ {s} –ø–æ–¥–∞—Ä–∫–æ–≤", restart: "–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê" },
        en: { score: "Gifts", time: "Time", over: "GAME OVER", res: "You delivered {s} gifts", restart: "PLAY AGAIN" }
    };

    let currentLang = 'en';
    let score = 0;
    let timeLeft = 30;
    let gameActive = false;

    function startGame(lang) {
        currentLang = lang;
        document.getElementById('lang-screen').style.display = 'none';
        document.getElementById('hud').style.display = 'flex';
        
        // UI matnlarini o'zgartirish
        document.getElementById('label-score').innerText = i18n[lang].score;
        document.getElementById('label-time').innerText = i18n[lang].time;
        
        gameActive = true;
        startTimer();
        spawnHouse();
    }

    // Santa harakati (Sichqoncha yoki Touch)
    window.addEventListener('mousemove', (e) => { if(gameActive) moveSanta(e.clientX) });
    window.addEventListener('touchmove', (e) => { if(gameActive) moveSanta(e.touches[0].clientX) });

    function moveSanta(x) {
        let pos = x - 25;
        if(pos < 0) pos = 0;
        if(pos > window.innerWidth - 50) pos = window.innerWidth - 50;
        document.getElementById('santa').style.left = pos + 'px';
    }

    // Sovg'a tashlash (Ekran bosilganda)
    window.addEventListener('mousedown', dropGift);
    window.addEventListener('touchstart', dropGift);

    function dropGift() {
        if(!gameActive) return;
        const gift = document.createElement('div');
        gift.className = 'gift';
        gift.innerText = 'üéÅ';
        gift.style.left = (document.getElementById('santa').offsetLeft + 10) + 'px';
        gift.style.top = (window.innerHeight - 80) + 'px';
        document.body.appendChild(gift);

        let gPos = window.innerHeight - 80;
        function fall() {
            gPos += 5;
            gift.style.top = gPos + 'px';
            
            // Uyga tegishini tekshirish
            const houses = document.querySelectorAll('.house');
            houses.forEach(h => {
                const hRect = h.getBoundingClientRect();
                const gRect = gift.getBoundingClientRect();
                if(!(gRect.right < hRect.left || gRect.left > hRect.right || gRect.bottom < hRect.top || gRect.top > hRect.bottom)) {
                    score++;
                    document.getElementById('score').innerText = score;
                    gift.remove();
                    h.innerText = 'üè†‚ú®'; // Uy yorishadi
                }
            });

            if(gPos < window.innerHeight) requestAnimationFrame(fall);
            else gift.remove();
        }
        fall();
    }

    function spawnHouse() {
        if(!gameActive) return;
        const house = document.createElement('div');
        house.className = 'house';
        house.innerText = 'üè†';
        house.style.left = window.innerWidth + 'px';
        document.body.appendChild(house);

        let hPos = window.innerWidth;
        function move() {
            hPos -= (3 + (score * 0.1)); // Tezlik oshib boradi
            house.style.left = hPos + 'px';
            if(hPos > -100) requestAnimationFrame(move);
            else house.remove();
        }
        move();
        setTimeout(spawnHouse, 1500);
    }

    function startTimer() {
        const timer = setInterval(() => {
            if(!gameActive) { clearInterval(timer); return; }
            timeLeft--;
            document.getElementById('time').innerText = timeLeft;
            if(timeLeft <= 0) {
                gameActive = false;
                showGameOver();
            }
        }, 1000);
    }

    function showGameOver() {
        document.getElementById('msg').style.display = 'flex';
        document.getElementById('game-over-title').innerText = i18n[currentLang].over;
        document.getElementById('final-res').innerText = i18n[currentLang].res.replace('{s}', score);
        document.getElementById('btn-restart').innerText = i18n[currentLang].restart;
    }
</script>
</body>
</html>