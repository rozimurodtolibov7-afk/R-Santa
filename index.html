<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Santa: Interactive Tree</title>
    <style>
        :root { --red: #ff4d4d; --gold: #ffd700; --dark: #0f0f1b; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--dark); color: white; margin: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }

        /* RC Panel */
        #top-bar { position: fixed; top: 10px; width: 100%; display: flex; justify-content: center; z-index: 1000; }
        .rc-panel { background: rgba(255,255,255,0.1); padding: 10px 25px; border-radius: 30px; border: 2px solid var(--gold); font-size: 20px; font-weight: bold; color: var(--gold); }

        /* Game Stage */
        #stage { height: 60vh; display: flex; align-items: center; justify-content: center; position: relative; padding-top: 50px; }
        #tree-area { position: relative; display: inline-block; }
        #main-tree { font-size: 180px; line-height: 1; user-select: none; }
        
        /* O'yinchoq stili */
        .toy-on-tree { 
            position: absolute; 
            font-size: 35px; 
            cursor: move; 
            z-index: 100; 
            user-select: none; 
            touch-action: none; 
            display: inline-block;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        }

        /* Santa Animation */
        #santa-gift { position: fixed; bottom: -300px; left: 50%; transform: translateX(-50%); transition: 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 2000; text-align: center; }
        #santa-gift.active { bottom: 150px; }
        .santa-emoji { font-size: 80px; }

        /* Menu */
        #menu { height: 40vh; background: rgba(255,255,255,0.05); display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; border-radius: 30px 30px 0 0; border-top: 1px solid rgba(255,255,255,0.1); }
        .btn { background: rgba(255,255,255,0.1); border: none; color: white; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; font-size: 14px; font-weight: bold; }
        .btn b { font-size: 24px; margin-bottom: 5px; }
        .btn:active { transform: scale(0.95); }
        .btn-save { background: var(--red) !important; }

        /* Modals */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; display: none; padding: 20px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .card { background: #1e1e2f; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #333; }
    </style>
</head>
<body>

<div id="top-bar">
    <div class="rc-panel">üí∞ <span id="rc-val">100</span> RC</div>
</div>

<div id="stage">
    <div id="tree-area">
        <div id="main-tree">üéÑ</div>
    </div>
</div>

<div id="santa-gift">
    <div class="santa-emoji">üéÖ</div>
    <div style="background:var(--red); padding:10px 20px; border-radius:15px; border:2px solid var(--gold); margin-top:-10px;">
        <b>HO-HO-HO!</b><br>+100 RC & Gift!
    </div>
</div>

<div id="menu">
    <button class="btn" onclick="openModal('shop')"><b>üõí</b>Shop</button>
    <button class="btn" onclick="openModal('chest')"><b>üì¶</b>Chest</button>
    <button class="btn" onclick="openModal('gifts')"><b>üéÅ</b>Gifts</button>
    <button class="btn" onclick="openModal('coll')"><b>üñºÔ∏è</b>Collection</button>
    <button class="btn btn-save" onclick="saveGame()"><b>üíæ</b>Save</button>
    <button class="btn" onclick="openModal('rate')"><b>üèÜ</b>Rating</button>
</div>

<div id="modal-shop" class="modal">
    <div class="modal-header"><h2>Shop</h2><span onclick="closeModal()" style="font-size:30px">√ó</span></div>
    <div class="grid" id="shop-list"></div>
</div>
<div id="modal-chest" class="modal">
    <div class="modal-header"><h2>My Chest</h2><span onclick="closeModal()" style="font-size:30px">√ó</span></div>
    <div class="grid" id="chest-list"></div>
</div>
<div id="modal-gifts" class="modal"><div class="modal-header"><h2>Gifts</h2><span onclick="closeModal()" style="font-size:30px">√ó</span></div><div class="grid" id="gift-list"></div></div>
<div id="modal-coll" class="modal"><div class="modal-header"><h2>Collection</h2><span onclick="closeModal()" style="font-size:30px">√ó</span></div><div class="grid" id="coll-list"></div></div>
<div id="modal-rate" class="modal"><div class="modal-header"><h2>Rating</h2><span onclick="closeModal()" style="font-size:30px">√ó</span></div><div id="rate-list" style="margin-top:20px"></div></div>

<script>
    let db = { rc: 100, inventory: ['‚≠ê'], gifts: [], collection: [], rating: [{n: "Player1", rc: 5000}, {n: "You", rc: 100}] };
    const shopItems = [{e: 'üî¥', p: 50}, {e: 'üîµ', p: 50}, {e: 'üîî', p: 100}, {e: 'üç≠', p: 150}, {e: '‚ùÑÔ∏è', p: 200}, {e: '‚ú®', p: 300}];

    function openModal(id) { document.getElementById('modal-' + id).style.display = 'block'; render(id); }
    function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

    function render(id) {
        let html = '';
        if(id === 'shop') {
            shopItems.forEach(i => html += `<div class="card"><h1>${i.e}</h1><p>${i.p} RC</p><button onclick="buy('${i.e}', ${i.p})">Buy</button></div>`);
            document.getElementById('shop-list').innerHTML = html;
        } else if(id === 'chest') {
            db.inventory.forEach(i => html += `<div class="card" onclick="placeToy('${i}')"><h1>${i}</h1><small>Tap to add</small></div>`);
            document.getElementById('chest-list').innerHTML = html || 'Empty';
        }
        // ... Rating va Gifts renderi (oldindagidek)
    }

    function buy(emoji, price) {
        if(db.rc >= price) { db.rc -= price; db.inventory.push(emoji); updateRC(); render('shop'); } else alert("Not enough RC!");
    }

    // O'yinchoqni archaga qo'yish
    function placeToy(emoji) {
        const toy = document.createElement('div');
        toy.className = 'toy-on-tree';
        toy.innerText = emoji;
        toy.style.left = '50%';
        toy.style.top = '50%';
        
        // Drag and Drop mantiqi (Sichqoncha va Sensor uchun)
        let isDragging = false;
        const move = (e) => {
            if (!isDragging) return;
            let x = (e.touches ? e.touches[0].clientX : e.clientX);
            let y = (e.touches ? e.touches[0].clientY : e.clientY);
            toy.style.left = (x - 20) + 'px';
            toy.style.top = (y - 20) + 'px';
            toy.style.position = 'fixed'; // Erkin harakatlanish uchun
        };

        toy.addEventListener('mousedown', () => isDragging = true);
        toy.addEventListener('touchstart', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        window.addEventListener('touchend', () => isDragging = false);
        window.addEventListener('mousemove', move);
        window.addEventListener('touchmove', move);

        document.body.appendChild(toy);
        closeModal();
    }

    function saveGame() {
        const santa = document.getElementById('santa-gift');
        db.rc += 100;
        db.gifts.push(shopItems[Math.floor(Math.random()*shopItems.length)].e);
        updateRC();
        santa.classList.add('active');
        setTimeout(() => { 
            santa.classList.remove('active'); 
            // O'yinchoqlarni archada qoldirish yoki tozalash (o'yinchi xohishiga qarab)
        }, 3000);
    }

    function updateRC() { document.getElementById('rc-val').innerText = db.rc; }
</script>
</body>
</html>