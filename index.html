<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Santa: RC Edition</title>
    <style>
        :root { --red: #ff4d4d; --gold: #ffd700; --dark: #050510; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--dark); color: white; margin: 0; font-family: sans-serif; overflow: hidden; touch-action: none; }

        /* Qor */
        .snowflake { position: fixed; top: -10px; color: white; pointer-events: none; z-index: 1; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh); } }

        /* RC Panel */
        #top-bar { position: fixed; top: 15px; width: 100%; display: flex; justify-content: center; z-index: 1000; }
        .rc-panel { background: rgba(255,255,255,0.1); padding: 10px 25px; border-radius: 30px; border: 2px solid var(--gold); font-size: 22px; font-weight: bold; color: var(--gold); backdrop-filter: blur(10px); box-shadow: 0 0 15px rgba(255,215,0,0.3); }

        /* Stage */
        #stage { height: 60vh; display: flex; align-items: center; justify-content: center; position: relative; z-index: 5; }
        .tree-svg { width: 280px; filter: drop-shadow(0 0 20px rgba(46, 204, 113, 0.4)); }
        .toy-on-tree { position: absolute; font-size: 45px; cursor: move; z-index: 100; user-select: none; touch-action: none; filter: drop-shadow(0 2px 10px rgba(0,0,0,0.5)); }

        /* Santa */
        #santa-gift { position: fixed; bottom: -500px; left: 50%; transform: translateX(-50%); transition: 0.8s; z-index: 2000; text-align: center; }
        #santa-gift.active { bottom: 150px; }

        /* Menu */
        #menu { height: 40vh; background: rgba(255,255,255,0.05); display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 20px; border-radius: 30px 30px 0 0; border-top: 1px solid rgba(255,255,255,0.1); }
        .btn { background: rgba(255,255,255,0.08); border: none; color: white; border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; font-size: 18px; }
        .btn b { font-size: 35px; margin-bottom: 5px; }
        .btn:active { transform: scale(0.95); background: rgba(255,255,255,0.15); }
        .btn-rc { background: linear-gradient(45deg, #ff4d4d, #c0392b) !important; box-shadow: 0 5px 20px rgba(255,77,77,0.4); }

        /* Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 3000; display: none; padding: 25px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .card { background: #161625; padding: 15px; border-radius: 20px; text-align: center; border: 1px solid #333; }
        .card h1 { font-size: 45px; margin: 10px 0; }
    </style>
</head>
<body>

<div id="top-bar">
    <div class="rc-panel">ðŸ’° <span id="rc-val">100</span> RC</div>
</div>

<div id="stage">
    <svg class="tree-svg" viewBox="0 0 200 260">
        <polygon points="100,10 180,110 20,110" fill="#2ecc71" />
        <polygon points="100,60 190,170 10,170" fill="#27ae60" />
        <polygon points="100,110 200,240 0,240" fill="#1e8449" />
        <rect x="85" y="240" width="30" height="20" fill="#5d4037" />
    </svg>
</div>

<div id="santa-gift">
    <div style="font-size: 100px;">ðŸŽ…</div>
    <div style="background:var(--red); padding:15px 30px; border-radius:20px; border:3px solid var(--gold);">
        <h2 style="margin:0">HO-HO-HO!</h2>
        <p>+100 RC sovg'a!</p>
    </div>
</div>

<div id="menu">
    <button class="btn" onclick="openModal('shop')"><b>ðŸ›’</b>Shop</button>
    <button class="btn" onclick="openModal('chest')"><b>ðŸ“¦</b>Chest</button>
    <button class="btn btn-rc" onclick="saveAndRC()"><b>ðŸ’Ž</b>RC</button>
    <button class="btn" onclick="playHolidayMusic()"><b>ðŸŽµ</b>Music</button>
</div>

<div id="modal-shop" class="modal">
    <h2 style="display:flex; justify-content:space-between">Bayram Do'koni <span onclick="closeModal()">Ã—</span></h2>
    <div class="grid" id="shop-list"></div>
</div>

<div id="modal-chest" class="modal">
    <h2 style="display:flex; justify-content:space-between">Mening Chest <span onclick="closeModal()">Ã—</span></h2>
    <div class="grid" id="chest-list"></div>
</div>

<script>
    let db = { rc: 100, inventory: ['â­'] };
    
    // Turfa xil o'yinchoqlar
    const shopItems = [
        {e:'ðŸ”´', p:30}, {e:'ðŸ”µ', p:30}, {e:'ðŸŸ¡', p:30}, {e:'ðŸŸ¢', p:30}, {e:'ðŸŸ£', p:40}, {e:'ðŸŸ ', p:40},
        {e:'ðŸŒŸ', p:100}, {e:'âœ¨', p:150}, {e:'â„ï¸', p:80}, {e:'ðŸ””', p:60}, {e:'ðŸ­', p:90}, {e:'ðŸŽ', p:200},
        {e:'ðŸ•¯ï¸', p:120}, {e:'ðŸŽ€', p:70}, {e:'ðŸª', p:50}, {e:'ðŸŒ™', p:110}, {e:'ðŸ’Ž', p:500}, {e:'ðŸ¦„', p:1000}
    ];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playNote(freq, dur, time) {
        const osc = audioCtx.createOscillator();
        const msg = audioCtx.createGain();
        osc.connect(msg); msg.connect(audioCtx.destination);
        osc.frequency.value = freq;
        osc.start(audioCtx.currentTime + time);
        msg.gain.setValueAtTime(0.1, audioCtx.currentTime + time);
        msg.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + time + dur);
        osc.stop(audioCtx.currentTime + time + dur);
    }

    function playHolidayMusic() {
        // Jingle Bells ohangi
        const melody = [
            659, 659, 659, 659, 659, 659, 659, 783, 523, 587, 659,
            698, 698, 698, 698, 698, 659, 659, 659, 659, 587, 587, 659, 587, 783
        ];
        melody.forEach((f, i) => playNote(f, 0.4, i * 0.35));
    }

    setInterval(() => {
        const s = document.createElement('div');
        s.className = 'snowflake'; s.innerHTML = 'â„';
        s.style.left = Math.random() * 100 + 'vw';
        s.style.animationDuration = Math.random() * 3 + 2 + 's';
        document.body.appendChild(s);
        setTimeout(() => s.remove(), 5000);
    }, 300);

    function openModal(id) { document.getElementById('modal-' + id).style.display = 'block'; render(id); }
    function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

    function render(id) {
        let html = '';
        if(id === 'shop') {
            shopItems.forEach(i => html += `<div class="card"><h1>${i.e}</h1><p>${i.p} RC</p><button onclick="buy('${i.e}', ${i.p})" style="width:100%; border:none; background:var(--gold); padding:10px; border-radius:12px; font-weight:bold">BUY</button></div>`);
            document.getElementById('shop-list').innerHTML = html;
        } else if(id === 'chest') {
            db.inventory.forEach(i => html += `<div class="card" onclick="placeToy('${i}')"><h1>${i}</h1><p>Add</p></div>`);
            document.getElementById('chest-list').innerHTML = html;
        }
    }

    function buy(e, p) { 
        if(db.rc >= p) { 
            db.rc -= p; db.inventory.push(e); 
            updateRC(); render('shop'); 
            playNote(880, 0.1, 0); 
        } else alert("RC yetarli emas!"); 
    }

    function placeToy(emoji) {
        const toy = document.createElement('div');
        toy.className = 'toy-on-tree';
        toy.innerText = emoji;
        toy.style.left = '50%'; toy.style.top = '40%';
        
        let isDragging = false;
        const move = (e) => {
            if (!isDragging) return;
            let x = (e.touches ? e.touches[0].clientX : e.clientX);
            let y = (e.touches ? e.touches[0].clientY : e.clientY);
            toy.style.left = (x - 25) + 'px';
            toy.style.top = (y - 25) + 'px';
        };
        toy.addEventListener('mousedown', () => isDragging = true);
        toy.addEventListener('touchstart', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        window.addEventListener('touchend', () => isDragging = false);
        window.addEventListener('mousemove', move);
        window.addEventListener('touchmove', move);

        document.body.appendChild(toy);
        closeModal();
    }

    function saveAndRC() {
        const santa = document.getElementById('santa-gift');
        db.rc += 100; updateRC();
        santa.classList.add('active');
        playNote(523, 0.5, 0);
        setTimeout(() => santa.classList.remove('active'), 3000);
    }

    function updateRC() { document.getElementById('rc-val').innerText = db.rc; }
    updateRC();
</script>
</body>
</html>